/*
 *  jquery-eclipsefdn-api - v0.0.4
 *  Fetch and display data from various Eclipse Foundation APIs.
 *  https://github.com/EclipseFdn/jquery-eclipsefdn-api
 *
 *  Made by Christopher Guindon
 *  Under MIT License
 *
 *  Thanks to https://github.com/jquery-boilerplate/jquery-boilerplate, MIT License Â© Zeno Rocha
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="eclipseFdnApi",g={apiUrl:"https://api.eclipse.org",gerritUrl:"https://git.eclipse.org/r",eventUrl:"https://events.eclipse.org/data/EclipseEvents.json",forumsUrl:"https://www.eclipse.org/forums",marketplaceUrl:"https://marketplace.eclipse.org",username:"cguindon",currentUser:"",contentPlaceholder:null,errorMsg:'<i class="fa red fa-exclamation-triangle" aria-hidden="true"></i> An unexpected error has occurred.',gerritUserNotFoundMsg:'<h2 class="h3">Outgoing Reviews</h2>There are no outgoing reviews for this user.<h2 class="h3">Incoming Reviews</h2>There are no incoming reviews for this account.',type:"",itemsPerPage:20};a.extend(e.prototype,{init:function(){var b=["mpFavorites","gerritReviews","recentEvents","forumsMsg","gerritReviewCount"];"string"===a.type(this.settings.type)&&a.inArray(this.settings.type,b)!==-1&&this[this.settings.type]()},forumsMsg:function(){var b=this,c=this.settings.username,e=this.settings.apiUrl;if(!c&&!api_url)return!1;var f=e+"/account/profile/"+c+"/forum";a.ajax(f,{context:this.element,success:function(c){var e=0;if(c.posted_msg_count!==d&&(e=c.posted_msg_count),a(this).children("strong").text(e+" posts"),!(b.settings.contentPlaceholder instanceof jQuery))return!1;var f=a(b.settings.contentPlaceholder),g=a("<a></a>");f.append(a("<h2></h2>").addClass("h3").text("Eclipse Forums")),f.append(a("<p></p>").append("The Eclipse forums are your way of communicating with the community of people developing and using Eclipse-based tools hosted at Eclipse.org. Please stick to technical issues - and remember, no confidential information - these are public forums!"));var h=g.clone().attr({href:b.settings.forumsUrl,class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');if(0===c.length)return f.append('<div class="alert alert-warning" role="alert">This user does not have any activities on Eclipse Forums.</div>'),f.append(h),!1;var i=a("<table></table>").attr({width:"100%",class:"table"}),j=a("<tr></tr>"),k=a("<th></th>"),l=a("<td></td>");j.append(k.clone().text("Topic").attr("width","50%")),j.append(k.clone().text("Replies").attr({width:"10%",class:"text-center"})),j.append(k.clone().text("Views").attr({width:"10%",class:"text-center"})),j.append(k.clone().text("Last message").attr({width:"30%",class:"text-center"})),i.append(j),a.each(c.posts,function(d,e){var f={forum_id:e.thread_forum_id,forum_name:e.forum_name,forum_cat_id:e.forum_name,forum_cat_name:e.cat_name,root_subject:e.root_msg_subject,current_user_last_post_timestamp:e.msg_group_post_stamp,current_user_last_post_subject:e.last_user_msg_subject,thread_id:e.msg_thread_id,thread_reply_count:e.thread_replies,thread_views_count:e.thread_views,thread_last_post_date:e.thread_last_post_date,last_message_timestamp:e.last_msg_post_stamp,last_message_poster_id:e.last_msg_poster_id,last_message_poster_alias:e.last_poster_alias,last_message_last_view:e.read_last_view,current_user_id:c.id};j=a("<tr></tr>");var h=g.clone().attr({href:b.settings.forumsUrl+"/index.php/f/"+f.forum_id+"/"}).text(f.forum_name),k=g.clone().attr({href:b.settings.forumsUrl+"/index.php/i/"+f.forum_cat_id+"/"}).text(f.forum_cat_name),m=a("<small></small>").append("<br/>").append(k).append(" &gt; ").append(h).append(" &gt; ").append(f.root_subject).append("<br>Posted on "+b.dateFormat(new Date(parseInt(1e3*f.current_user_last_post_timestamp))));j.append(l.clone().html(g.clone().attr({href:b.settings.forumsUrl+"/index.php/t/"+f.thread_id+"/"}).text(f.current_user_last_post_subject)).append(m)),j.append(l.clone().text(f.thread_reply_count).attr("class","text-center")),j.append(l.clone().text(f.thread_views_count).attr("class","text-center"));var n=a("<small></small>").append(b.dateFormat(new Date(parseInt(1e3*f.last_message_timestamp)))).append("<br/> By: ").append(g.clone().attr({href:b.settings.forumsUrl+"/index.php/u/"+f.last_message_poster_id+"/"}).text(f.last_message_poster_alias));j.append(l.clone().html(n).attr("class","text-center")),b.settings.currentUser===b.settings.username&&f.last_message_last_view<f.thread_last_post_date&&f.last_message_poster_id!==f.current_user_id&&j.addClass("warning"),i.append(j)}),f.append(i),f.append(h)},error:function(){a(this).html(b.settings.errorMsg)}})},mpFavorites:function(){var b=this,c=this.settings.username,d=this.settings.apiUrl;if(!c&&!api_url)return!1;if(b.settings.contentPlaceholder instanceof jQuery){var e=a(b.settings.contentPlaceholder),f=a("<a></a>").attr({href:b.settings.marketplaceUrl,class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');e.append(a("<h2></h2>").addClass("h3").text("Eclipse Marketplace Favorites")),e.append(a("<p></p>").append("Eclipse Marketplace is the source for Eclipse-based solutions, products and add-on features. Thousands of developers visit Marketplace on a monthly basis to find new and innovative solutions. Solution providers are encouraged to list their products on Marketplace to gain exposure to the Eclipse developer community."))}var g=d+"/marketplace/favorites?name="+c;a.ajax(g,{context:this.element,success:function(c){if(a(this).children("strong").text(c.total_result_count+" favorites"),"undefined"==typeof e)return!1;var d=[];if(a.each(c.mpc_favorites,function(a,b){d.push(b.content_id)}),0===d.length)return e.append('<div class="alert alert-warning" role="alert">There are no marketplace favorites for this user.</div>'),e.append(f),!1;var g=d.join(","),h=b.settings.marketplaceUrl+"/node/"+g+"/api/p";a.ajax(h,{context:b.element,success:function(c){e.append('<div class="alert alert-info" role="alert"><label>Copy this URL and paste it into MPC to install this list of favorites in your workspace: </label><input class="text-full form-control form-text" type="text" readonly value="https://marketplace.eclipse.org/user/'+b.settings.username+'/favorites" width="100"></div>');var d=a("node",c);d.each(function(c,d){var f=a(d),g=f.find("shortdescription").text(),h=d.getAttribute("name"),i=f.find("changed").text(),j=f.find("owner").text(),k="Last Updated on "+b.dateFormat(new Date(parseInt(1e3*i)))+" by "+j,l=d.getAttribute("id"),m=a("#mp-listing-template").clone().removeClass("hidden").removeAttr("id"),n=a("<a></a>"),o=a("category",d),p=b.settings.marketplaceUrl+"/node/"+l,q=f.find("image").text(),r=n.clone().attr({href:p});o.each(function(a,b){var c=n.clone().attr({href:b.getAttribute("url")}).text(b.getAttribute("name"));o.length!==a+1&&c.append(", "),m.find(".content-categories").append(c)}),m.find(".listing-image").attr({href:p,style:"background:url('"+q+"') no-repeat center;"}),m.find(".drag").attr({href:b.settings.marketplaceUrl+"/marketplace-client-intro?mpc_install="+l}),m.find(".listing-title").html(r.clone().text(h)),m.find(".content-teaser").html(g),m.find(".content-last-updated").html(k),e.append(m)}),e.append(f)},error:function(){a(this).html(b.settings.errorMsg)}})},error:function(){a(this).html(b.settings.errorMsg)}})},gerritReviewCount:function(){var b=this,c=this.settings.username,d=this.settings.apiUrl,e=d+"/account/profile/"+c+"/gerrit";a.ajax(e,{context:this.element,success:function(c){var d=c.merged_changes_count;a(this).children("strong").text(d+" reviews"),d>0&&a(this).children("strong").attr({href:"https://git.eclipse.org/r/#/q/owner:"+b.settings.username})},error:function(){a(this).html(b.settings.errorMsg)}})},gerritReviews:function(){function b(b,e){var g=a("<a></a>").attr({href:d.settings.gerritUrl,class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');b!==f?c(f,"gerrit-incoming","Incoming Reviews",e):e.append(g)}function c(c,e,f,g){a.ajax(c+"&n=10&start=0",{dataType:"gerrit_XSSI",context:g,converters:{"text gerrit_XSSI":function(a){var b=a.substring(a.indexOf("\n")+1);return jQuery.parseJSON(b)}},success:function(e){var g=a(this),h=a("<h4></h4>").addClass("h4").text(f);if(g.append(h),0===e.length)return g.append('<div class="alert alert-warning" role="alert">There are no '+f.toLowerCase()+" for this user.</div>"),b(c,g),!1;var i=a("<table></table>").attr({width:"100%",class:"table"}),j=a("<tr></tr>"),k=a("<th></th>"),l=a("<td></td>");j.append(k.clone().text("Subject").attr("width","70%")),j.append(k.clone().text("Status").attr({width:"18%",class:"text-center"})),j.append(k.clone().text("Updated").attr({width:"12%",class:"text-center"})),i.append(j);var m=a("<a></a>");a.each(e,function(b,c){j=a("<tr></tr>");var e="";c.mergeable===!1&&(e="Merge Conflict",j.addClass("warning"));var f=c.updated.substring(0,c.updated.indexOf(" "));j.append(l.clone().html(m.clone().attr({href:d.settings.gerritUrl+"/"+c._number}).text(c.subject)).append("<br/>"+c.project)),j.append(l.clone().text(e).attr("class","text-center")),j.append(l.clone().text(f).attr("class","text-center")),i.append(j)}),g.append(i),b(c,g)},error:function(e){400===e.status?(a(this).html(d.settings.gerritUserNotFoundMsg),b(c,container)):a(this).html(d.settings.errorMsg)}})}var d=this,e=this.settings.gerritUrl+"/changes/?q=owner:"+this.settings.username+"+status:open",f=this.settings.gerritUrl+"/changes/?q=reviewer:"+this.settings.username+"+status:open+-owner:"+this.settings.username;c(e,"gerrit-outgoing","Outgoing Reviews",this.element),a(this.element).append(a("<h2>Eclipse Gerrit</h2>").addClass("h3")),a(this.element).append("<p>Gerrit is a web based code review system, facilitating online code reviews for projects using the Git version control system.</p>")},recentEvents:function(){function b(a,b){return a.dateTime-b.dateTime}var c=this;a.ajax(this.settings.eventUrl,{context:this.element,success:function(d){var e=new Date,f=[];for(var g in d.events)d.events[g].dateTime=new Date(d.events[g].date),d.events[g].dateTime>=e&&f.push(d.events[g]);f.sort(b);var h=a("<ul></ul>").attr({class:"nav",style:"margin:0"});for(var i in f.slice(0,5)){var j=f[i].dateTime,k=c.dateFormat(j),l=a("<a>").attr({href:f[i].infoLink}).html(f[i].title+"<br/><small>"+k+"</small>"),m=a("<li></li>").append(l);h.append(m)}a(this).children(".loading").remove(),a(this).append(h);var n=a("<a>").attr({href:"http://events.eclipse.org",class:"btn btn-simple btn-sm"}).text("more");a(this).append(n)},error:function(){a(this).html(c.settings.errorMsg)}})},dateFormat:function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=a.getFullYear(),e=b[a.getMonth()],f=c[a.getDay()],g=a.getDate(),h=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),j=f+", "+e+" "+g+", "+d+" - "+h+":"+i;return j},getPaginationBar:function(b,c,d){function e(a){return"undefined"==typeof a||a<1?1:a>f()?f():a}function f(){return Math.ceil(b/g.settings.itemsPerPage)}var g=this,h=g.settings.type;if("undefined"==typeof b&&(b=1),c=e(c),!(b<=0||b<=g.settings.itemsPerPage)){var i=f(),j=1,k=i,l=a("<nav></nav>").attr({"arial-label":"Page navigation"}).addClass("text-center"),m=a("<ul></ul>").addClass("pagination").attr({"data-eclipseFdnApi-type":h});"undefined"!=typeof d&&m.attr({"data-eclipseFdnApi-elementID":d,id:d+"-pager"});var n=a("<li></li>"),o=a("<a></a>"),p=a("<span></span>"),q=!1,r="";i>9&&(j=i-8,k=i,c<=j+4?k=9:c<=i-4&&(j=c-4,k=c+4),q=!0,r=n.clone().append(p.clone().attr({"aria-hidden":"true",onclick:"return false;"}).html("...")).addClass("pager-ellipses disabled")),1!==c&&(m.append(n.clone().addClass("pager-first").html(o.clone().attr({href:"#","aria-label":"First",onclick:"return false;","data-goto-page":"1"}).append(p.clone().attr({"aria-hidden":"true"}).html("<< first")))),m.append(n.clone().html(o.clone().attr({href:"#","aria-label":"Previous",onclick:"return false;","data-goto-page":parseInt(c-1)}).append(p.clone().attr({"aria-hidden":"true"}).html("< previous")))),q===!0&&j>1&&m.append(r.clone()));var s;for(s=j;s<=k;s++){var t=n.clone(),u=o.clone().attr({href:"#",title:"Go to page "+parseInt(s),onclick:"return false;","data-goto-page":parseInt(s)}).text(parseInt(s));c===s&&t.addClass("active"),t.html(u),m.append(t)}return c<i&&(q===!0&&k<i&&m.append(r.clone()),m.append(n.clone().html(o.clone().attr({href:"#","aria-label":"Next",title:"Go to next page",onclick:"return false;","data-goto-page":parseInt(c+1)}).append(p.clone().attr({"aria-hidden":"true"}).html("next >")))),m.append(n.clone().addClass("pager-last").html(o.clone().attr({href:"#","aria-label":"Last",title:"Go to last page",onclick:"return false;","data-goto-page":parseInt(i)}).append(p.clone().attr({"aria-hidden":"true"}).html("last >>"))))),l.append(m),l}}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);