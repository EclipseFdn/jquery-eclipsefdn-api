/*
 *  jquery-eclipsefdn-api - v0.0.10
 *  Fetch and display data from various Eclipse Foundation APIs.
 *  https://github.com/EclipseFdn/jquery-eclipsefdn-api
 *
 *  Made by Christopher Guindon
 *  Under MIT License
 *
 *  Thanks to https://github.com/jquery-boilerplate/jquery-boilerplate, MIT License Â© Zeno Rocha
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="eclipseFdnApi",g={apiUrl:"https://api.eclipse.org",gerritUrl:"https://git.eclipse.org/r",eventUrl:"https://events.eclipse.org/data/EclipseEvents.json",forumsUrl:"https://www.eclipse.org/forums",marketplaceUrl:"https://marketplace.eclipse.org",username:"cguindon",currentUser:"",contentPlaceholder:null,errorMsg:'<i class="fa red fa-exclamation-triangle" aria-hidden="true"></i> An unexpected error has occurred.',gerritUserNotFoundMsg:'<h2 class="h3">Outgoing Reviews</h2>There are no outgoing reviews for this user.<h2 class="h3">Incoming Reviews</h2>There are no incoming reviews for this account.',type:"",itemsPerPage:10};a.extend(e.prototype,{init:function(){var b=["mpFavorites","gerritReviews","recentEvents","forumsMsg","gerritReviewCount","projectsList"];"string"===a.type(this.settings.type)&&a.inArray(this.settings.type,b)!==-1&&this[this.settings.type]()},projectsList:function(){var b=this,c=this.settings.username,e=this.settings.apiUrl;if(!c&&!api_url)return!1;var f=e+"/account/profile/"+c+"/projects";a.ajax(f,{context:this.element,success:function(c){var e=Object.keys(c).length;if(e===d&&(e=0),a(this).attr({href:"https://projects.eclipse.org/"}),a(this).children("strong").text(e+b.plurialString(" project",e)),!(b.settings.contentPlaceholder instanceof jQuery))return!1;var f=a(b.settings.contentPlaceholder),g=a("<a></a>");if(f.append(a("<h2></h2>").addClass("h3").text("Eclipse Projects")),f.append('<p>Projects are the organizational unit for open source development work at the Eclipse Foundation. Projects have developers (committers), source code repositories, build servers, downloads, and other resources. The Eclipse Foundation\'s open source projects are governed by the <a href="https://eclipse.org/projects/dev_process/">Eclipse Development Process</a>.</p>'),0===e)return f.append('<div class="alert alert-warning" role="alert">This user is not involved in any Eclipse Projects.</div>'),!1;var h=a("<table></table>").attr({width:"100%",class:"table"}),i=a("<tr></tr>"),j=a("<th></th>"),k=a("<td></td>");i.append(j.clone().text("Project").attr("width","85%")),i.append(j.clone().text("Relation").attr({width:"15%",class:"text-center"})),h.append(i),a.each(c,function(c,d){var e=[],f="",j="";a.each(d,function(a,b){e.push(b.Relation.Description),f=b.ProjectName,j=b.ActiveDate,""!==b.url&&(f=g.clone().attr({href:b.url}).text(f))}),i=a("<tr></tr>"),i.append(k.clone().html(f).append("<br/><small>Since: "+b.dateFormat(new Date(j))+"</small>")),i.append(k.clone().text(e.join(", ")).attr("class","text-center")),h.append(i)}),f.append(h)},error:function(){a(this).html(b.settings.errorMsg)}})},forumsMsg:function(){var b=this,c=this.settings.username,e=this.settings.apiUrl;if(!c&&!api_url)return!1;var f=e+"/account/profile/"+c+"/forum";a.ajax(f,{context:this.element,success:function(c){var e=0;if(c.posted_msg_count!==d&&(e=c.posted_msg_count,a(this).attr({href:b.settings.forumsUrl+"/index.php/sp/"+c.id+"/"})),a(this).children("strong").text(e+b.plurialString(" topic",e)),!(b.settings.contentPlaceholder instanceof jQuery))return!1;var f=a(b.settings.contentPlaceholder),g=a("<a></a>");f.append(a("<h2></h2>").addClass("h3").text("Eclipse Forums")),f.append(a("<p></p>").append("The Eclipse forums are your way of communicating with the community of people developing and using Eclipse-based tools hosted at Eclipse.org. Please stick to technical issues - and remember, no confidential information - these are public forums!"));var h=g.clone().attr({href:b.settings.forumsUrl,class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');if(0===c.length)return f.append('<div class="alert alert-warning" role="alert">This user does not have any activities on Eclipse Forums.</div>'),f.append(h),!1;var i=a("<table></table>").attr({width:"100%",class:"table"}),j=a("<tr></tr>"),k=a("<th></th>"),l=a("<td></td>");b.settings.currentUser===b.settings.username&&j.append(k.clone().attr("width","8%")),j.append(k.clone().text("Topics").attr("width","50%")),j.append(k.clone().text("Replies").attr({width:"8%",class:"text-center"})),j.append(k.clone().text("Views").attr({width:"8%",class:"text-center"})),j.append(k.clone().text("Last message").attr({class:"text-center"})),i.append(j),a.each(c.posts,function(d,e){var f={forum_id:e.thread_forum_id,forum_name:e.forum_name,forum_cat_id:e.forum_name,forum_cat_name:e.cat_name,root_subject:e.root_msg_subject,current_user_last_post_timestamp:e.msg_group_post_stamp,current_user_last_post_subject:e.last_user_msg_subject,thread_id:e.msg_thread_id,thread_reply_count:e.thread_replies,thread_views_count:e.thread_views,thread_last_post_date:e.thread_last_post_date,last_message_timestamp:e.last_msg_post_stamp,last_message_poster_id:e.last_msg_poster_id,last_message_poster_alias:e.last_poster_alias,last_message_last_view:e.read_last_view,current_user_id:c.id};h.attr({href:b.settings.forumsUrl+"/index.php/sp/"+f.current_user_id+"/"}),j=a("<tr></tr>");var k=g.clone().attr({href:b.settings.forumsUrl+"/index.php/f/"+f.forum_id+"/"}).text(f.forum_name),m=g.clone().attr({href:b.settings.forumsUrl+"/index.php/i/"+f.forum_cat_id+"/"}).text(f.forum_cat_name),n=a("<small></small>").append("<br/>").append(m).append(" &gt; ").append(k).append(" &gt; ").append(f.root_subject).append("<br>Posted on "+b.dateFormat(new Date(parseInt(1e3*f.current_user_last_post_timestamp)))),o="fa fa-envelope-open-o";b.settings.currentUser===b.settings.username&&f.last_message_last_view<f.thread_last_post_date&&f.last_message_poster_id!==f.current_user_id&&(j.addClass("warning"),o="fa fa-envelope-o"),b.settings.currentUser===b.settings.username&&j.append(l.clone().html('<i class="'+o+'" aria-hidden="true"></i>').attr("class","text-center")),j.append(l.clone().html(g.clone().attr({href:b.settings.forumsUrl+"/index.php/t/"+f.thread_id+"/"}).text(f.current_user_last_post_subject)).append(n)),j.append(l.clone().text(f.thread_reply_count).attr("class","text-center")),j.append(l.clone().text(f.thread_views_count).attr("class","text-center"));var p=a("<small></small>").append(b.dateFormat(new Date(parseInt(1e3*f.last_message_timestamp)))).append("<br/> By: ").append(g.clone().attr({href:b.settings.forumsUrl+"/index.php/sp/"+f.last_message_poster_id+"/"}).text(f.last_message_poster_alias));j.append(l.clone().html(p).attr("class","text-center")),i.append(j)}),f.append(i),f.append(h)},error:function(){a(this).html(b.settings.errorMsg)}})},mpFavorites:function(){function b(b){var c=d.settings.marketplaceUrl+"/node/"+b+"/api/p";a.ajax(c,{context:d.element,success:function(b){var c=a("#mpfavorites-list"),e=a("node",b);e.each(function(b,e){var f=a(e),g=f.find("shortdescription").text(),h=e.getAttribute("name"),i=f.find("changed").text(),j=f.find("owner").text(),k="Last Updated on "+d.dateFormat(new Date(parseInt(1e3*i)))+" by "+j,l=e.getAttribute("id"),m=a("#mp-listing-template").clone().removeClass("hidden").removeAttr("id"),n=a("<a></a>"),o=a("category",e),p=d.settings.marketplaceUrl+"/node/"+l,q=f.find("image").text(),r=n.clone().attr({href:p});o.each(function(a,b){var c=n.clone().attr({href:b.getAttribute("url")}).text(b.getAttribute("name"));o.length!==a+1&&c.append(", "),m.find(".content-categories").append(c)}),m.find(".listing-image").attr({href:p,style:"background:url('"+q+"') no-repeat center;"}),m.find(".drag").attr({href:d.settings.marketplaceUrl+"/marketplace-client-intro?mpc_install="+l}),m.find(".listing-title").html(r.clone().text(h)),m.find(".content-teaser").html(g),m.find(".content-last-updated").html(k),c.append(m)})},error:function(){a(this).html(d.settings.errorMsg)}})}function c(a,c){b(c)}var d=this,e=this.settings.username,f=this.settings.apiUrl;if(!e&&!api_url)return!1;if(d.settings.contentPlaceholder instanceof jQuery){var g=a(d.settings.contentPlaceholder),h=a("<a></a>").attr({href:d.settings.marketplaceUrl+"/user/"+e+"/favorites",class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');g.append(a("<h2></h2>").addClass("h3").text("Eclipse Marketplace Favorites")),g.append(a("<p></p>").append("Eclipse Marketplace is the source for Eclipse-based solutions, products and add-on features. Thousands of developers visit Marketplace on a monthly basis to find new and innovative solutions. Solution providers are encouraged to list their products on Marketplace to gain exposure to the Eclipse developer community."))}var i=f+"/marketplace/favorites?name="+e;a.ajax(i,{context:this.element,success:function(e){if(a(this).children("strong").text(e.total_result_count+d.plurialString(" favorite",e.total_result_count)),"undefined"==typeof g)return!1;var f=[];if(a.each(e.mpc_favorites,function(a,b){f.push(b.content_id)}),0===f.length)return g.append('<div class="alert alert-warning" role="alert">There are no marketplace favorites for this user.</div>'),g.append(h),!1;var i=[],j=1,k=1;i[j]=[],a.each(f,function(a,b){i[j].push(b),++k>d.settings.itemsPerPage&&(j++,k=1,i[j]=[])}),g.on("fetchFavoritesEvent",c),g.append('<div class="alert alert-info" role="alert"><label>Copy this URL and paste it into MPC to install this list of favorites in your workspace: </label><input class="text-full form-control form-text" type="text" readonly value="https://marketplace.eclipse.org/user/'+d.settings.username+'/favorites" width="100"></div>'),g.append('<div id="mpfavorites-list"></div>'),g.find("#mpfavorites-list").data("nodestrs",i),b(i[1].join()),g.append(d.getPaginationBar(f.length,"mpfavorites-list")),g.append(h)},error:function(){a(this).html(d.settings.errorMsg)}})},gerritReviewCount:function(){var b=this,c=this.settings.username,d=this.settings.apiUrl,e=d+"/account/profile/"+c+"/gerrit";a.ajax(e,{context:this.element,success:function(c){var d=c.merged_changes_count;a(this).children("strong").text(d+b.plurialString(" review",d)),d>0&&a(this).attr({href:b.settings.gerritUrl+"/#/q/owner:"+b.settings.username})},error:function(){a(this).html(b.settings.errorMsg)}})},gerritReviews:function(){function b(b){function d(){function b(b,d){var e=a("<table></table>").attr({width:"100%",class:"table",id:b}),f=a("<tr></tr>"),g=a("<th></th>"),h=a("<td></td>");f.append(g.clone().text("Subject").attr("width","70%")),f.append(g.clone().text("Status").attr({width:"18%",class:"text-center"})),f.append(g.clone().text("Updated").attr({width:"12%",class:"text-center"})),e.append(f);var i=a("<a></a>");return a.each(d,function(b,d){f=a("<tr></tr>");var g="";d.mergeable===!1&&(g="Merge Conflict",f.addClass("warning"));var j=d.updated.substring(0,d.updated.indexOf(" "));f.append(h.clone().html(i.clone().attr({href:c.settings.gerritUrl+"/"+d._number}).text(d.subject)).append("<br/>"+d.project)),f.append(h.clone().text(g).attr("class","text-center")),f.append(h.clone().text(j).attr("class","text-center")),e.append(f)}),e}a.each(i,function(d,e){var f="";switch(e[0]){case"gerrit-outgoing":f="Outgoing Reviews";break;case"gerrit-incoming":f="Incoming Reviews"}var g=a("<h4></h4>").addClass("h4").text(f);return a(c.element).append(g),0===e[1].length?void a(c.element).append('<div class="alert alert-warning" role="alert">There are no '+f.toLowerCase()+" for this user.</div>"):(a(c.element).append(b(e[0],e[1])),void a(c.element).append(c.getPaginationBar(e[1].length,e[0])))});var d=a("<a></a>").attr({href:c.settings.gerritUrl+"/#/q/owner:"+c.settings.username,class:"btn btn-primary btn-sm",style:"display:block"}).html('<i class="fa fa-angle-double-right" aria-hidden="true"></i> More');a(c.element).append(d)}function e(b,d,f){return d="undefined"!=typeof d?d:100,f="undefined"!=typeof f?f:0,b+="&start="+f+"&n="+d,a.ajax(b,{dataType:"gerrit_XSSI",context:c.element,converters:{"text gerrit_XSSI":function(a){var b=a.substring(a.indexOf("\n")+1);return jQuery.parseJSON(b)}},success:function(g){var h=Object,j=Object;0!==g[0].length&&(a.merge(i[0][1],g[0]),h=g[0][g[0].length-1]),0!==g[1].length&&(a.merge(i[1][1],g[1]),j=g[1][g[1].length-1]),"_more_changes"in h&&h._more_changes===!0||"_more_changes"in j&&j._more_changes===!0?e(b,d,f+d):a(c.element).trigger("drawTableEvent")},error:function(b){400===b.status?a(this).html(c.settings.gerritUserNotFoundMsg):a(this).html(c.settings.errorMsg),h=!0}})}var f=100,g=0,h=!1,i=[["gerrit-outgoing",[]],["gerrit-incoming",[]]];a(c.element).on("drawTableEvent",d),e(b,f,g)}var c=this,d=this.settings.gerritUrl+"/changes/?q=owner:"+this.settings.username+"+status:open&q=reviewer:"+this.settings.username+"+status:open+-owner:"+this.settings.username+"&pp=0";a(this.element).append(a("<h2>Eclipse Gerrit</h2>").addClass("h3")),a(this.element).append("<p>Gerrit is a web based code review system, facilitating online code reviews for projects using the Git version control system.</p>"),b(d)},recentEvents:function(){function b(a,b){return a.dateTime-b.dateTime}var c=this;a.ajax(this.settings.eventUrl,{context:this.element,success:function(d){var e=new Date,f=[];for(var g in d.events)d.events[g].dateTime=new Date(d.events[g].date),d.events[g].dateTime>=e&&f.push(d.events[g]);f.sort(b);var h=a("<ul></ul>").attr({class:"nav",style:"margin:0"});for(var i in f.slice(0,5)){var j=f[i].dateTime,k=c.dateFormat(j),l=a("<a>").attr({href:f[i].infoLink}).html(f[i].title+"<br/><small>"+k+"</small>"),m=a("<li></li>").append(l);h.append(m)}a(this).children(".loading").remove(),a(this).append(h);var n=a("<a>").attr({href:"http://events.eclipse.org",class:"btn btn-simple btn-sm"}).text("more");a(this).append(n)},error:function(){a(this).html(c.settings.errorMsg)}})},plurialString:function(a,b){return b>1&&(a+="s"),a},dateFormat:function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=a.getFullYear(),e=b[a.getMonth()],f=c[a.getDay()],g=a.getDate(),h=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),j=f+", "+e+" "+g+", "+d+" - "+h+":"+i;return j},getPaginationBar:function(b,c){function d(b,c,d){var e=a("<li></li>"),f=a("<a></a>"),g=a("<span></span>"),h=a("<ul></ul>").addClass("pagination");"undefined"!=typeof d&&h.attr({"data-eclipseFdnApi-elementID":d});var i=!1,j="",k=1,l=b;b>9&&(k=b-8,c<=k+4?(l=9,k=1):c<=b-4&&(k=c-4,l=c+4),i=!0,j=e.clone().append(g.clone().attr({"aria-hidden":"true",onclick:"return false;"}).html("...")).addClass("pager-ellipses disabled"));var m=function(){var b=a(this),c=b.attr("data-goto-page"),d=b.parents(".pagination").eq(0),e=d.data("eclipsefdnapiElementid");a("#"+e).trigger("changePageEvent",[c])};1!==c&&(h.append(e.clone().addClass("pager-first").html(f.clone().attr({href:"#","aria-label":"First",onclick:"return false;","data-goto-page":"1"}).on("click",m).append(g.clone().attr({"aria-hidden":"true"}).html("<< first")))),h.append(e.clone().html(f.clone().attr({href:"#","aria-label":"Previous",onclick:"return false;","data-goto-page":parseInt(c-1)}).on("click",m).append(g.clone().attr({"aria-hidden":"true"}).html("< previous")))),i===!0&&k>1&&h.append(j.clone()));var n;for(n=k;n<=l;n++){var o=e.clone(),p=f.clone().attr({href:"#",title:"Go to page "+parseInt(n),onclick:"return false;","data-goto-page":parseInt(n)}).text(parseInt(n)).on("click",m);c===n&&o.addClass("active"),o.html(p),h.append(o)}return c<b&&(i===!0&&l<b&&h.append(j.clone()),h.append(e.clone().html(f.clone().attr({href:"#","aria-label":"Next",title:"Go to next page",onclick:"return false;","data-goto-page":parseInt(c+1)}).on("click",m).append(g.clone().attr({"aria-hidden":"true"}).html("next >")))),h.append(e.clone().addClass("pager-last").html(f.clone().attr({href:"#","aria-label":"Last",title:"Go to last page",onclick:"return false;","data-goto-page":parseInt(b)}).on("click",m).append(g.clone().attr({"aria-hidden":"true"}).html("last >>"))))),h}function e(){return Math.ceil(b/h.settings.itemsPerPage)}function f(){function b(b){var c=[];return a.each(b,function(b,e){return"table"===d&&0===b&&a(e).children().first().is("th")?void(c[0]=e):(j===h.settings.itemsPerPage&&(j=0,l++,c[l]=m,m=[]),m[j]=e,void j++)}),m.length>0&&(c[++l]=m),c}var d,e,f=a("#"+c),i=[],j=0,l=0,m=[];switch(f.is("table")?(e=f.find("tr"),d="table",i=b(e)):f.is("div")&&"mpfavorites-list"===c&&(d="nodes"),f.data("pageCache",i),f.data("pageCacheType",d),f.data("pageCacheTotalPages",k),f.on("changePageEvent",g),d){case"table":f.trigger("changePageEvent",[1])}}function g(b,c){var e=a(b.currentTarget),f=e.data("pageCacheType"),g=e.data("pageCache"),h=e.data("pageCacheTotalPages"),i=e.attr("id"),j=a("#"+i+"-pager"),k=j.data("currentPage");switch("undefined"!=typeof k&&null!==k||(k=1,j.data("currentPage",k)),"undefined"==typeof c&&(c=1),c=parseInt(c),f){case"table":e.empty(),e.append(g[0]),a.each(g[c],function(a,b){e.append(b)});break;case"nodes":if("undefined"==typeof g[k]){var l=e.find(".node");g[k]=l,e.data("pageCache",g)}if(e.empty(),"undefined"==typeof g[c]){var m=e.data("nodestrs")[c].join();e.trigger("fetchFavoritesEvent",[m]);break}a.each(g[c],function(a,b){e.append(b)})}if(k!==c){var n=d(h,c,i);j.find("ul").replaceWith(n),j.data("currentPage",c)}}var h=this;if("undefined"==typeof b&&(b=1),!(b<=0||b<=h.settings.itemsPerPage)){var i=1,j=a("<nav></nav>").attr({"arial-label":"Page navigation",id:c+"-pager"}).addClass("text-center"),k=e(),l=d(k,i,c);return j.append(l),"undefined"==typeof a("#"+c).data("pageCache")&&f(),j}}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);