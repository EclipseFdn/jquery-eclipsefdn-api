/*
 *  jquery-eclipse-api - v0.0.1
 *  Fetch and display data from various Eclipse Foundation APIs.
 *  https://github.com/EclipseFdn/jquery-eclipse-api
 *
 *  Made by Christopher Guindon
 *  Under MIT License
 *
 *  Thanks to https://github.com/jquery-boilerplate/jquery-boilerplate, MIT License Â© Zeno Rocha
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="eclipseApi",g={eclipseApiUrl:"https://api.eclipse.org",eclipseGerritUrl:"https://git.eclipse.org/r",eclipseEventUrl:"https://events.eclipse.org/data/EclipseEvents.json",username:"cguindon",type:null};a.extend(e.prototype,{init:function(){var b=["mpFavorites","gerritReviews","eclipseEvents"];"string"===a.type(this.settings.type)&&a.inArray(this.settings.type,b)&&this[this.settings.type]()},mpFavorites:function(){var b=this.settings.username,c=this.settings.eclipseApiUrl;if(!b&&!api_url)return FALSE;var d=c+"/marketplace/favorites?name="+b;a.ajax(d,{context:this.element,success:function(b){a(this).text(b.total_result_count+" fav")},error:function(){a(this).html('<i class="fa red fa-exclamation-triangle" aria-hidden="true"></i>')}})},gerritReviews:function(){function b(b,c,d,e){a.ajax(b,{dataType:"gerrit_XSSI",context:e,converters:{"text gerrit_XSSI":function(a){var b=a.substring(a.indexOf("\n")+1);return jQuery.parseJSON(b)}},success:function(b){var c=a(this).hide(),e=a("<h2></h2>").addClass("h3").text(d);if(c.append(e),0===b.length)return c.append("There are no "+d.toLowerCase()+" for this user.").fadeIn(1e3),FALSE;var f=a("<table></table>").attr({width:"100%",class:"table"}),g=a("<tr></tr>"),h=a("<th></th>");g.append(h.clone().text("Subject").attr("width","70%")),g.append(h.clone().text("Status").attr({width:"18%",class:"text-center"})),g.append(h.clone().text("Updated").attr({width:"12%",class:"text-center"})),f.append(g),a.each(b,function(b,c){var d=a("<tr></tr>"),e="";c.mergeable===!1&&(e="Merge Conflict",d.addClass("warning"));var g=c.updated.substring(0,c.updated.indexOf(" "));d.append('<td><a href="https://git.eclipse.org/r/#/c/'+c._number+'">'+c.subject+"</a><br/>"+c.project+"</td>"),d.append('<td class="text-center">'+e+"</td>"),d.append('<td class="text-center">'+g+"</td>"),f.append(d)}),c.append(f).fadeIn(1e3)},error:function(b){400===b.status?a(this).html('<h2 class="h3">Outgoing Reviews</h2>There are no outgoing reviews for this user.<h2 class="h3">Incoming Reviews</h2>There are no incoming reviews for this account.'):a(this).html('<strong><i class="fa red fa-exclamation-triangle" aria-hidden="true"></i> An unexpected error has occurred.</strong>')}})}var c=this.settings.eclipseGerritUrl+"/changes/?q=owner:"+this.settings.username+"+status:open",d=this.settings.eclipseGerritUrl+"/changes/?q=reviewer:"+this.settings.username+"+status:open+-owner:"+this.settings.username;b(c,"gerrit-outgoing","Outgoing Reviews",this.element),b(d,"gerrit-incoming","Incoming Reviews",this.element)},eclipseEvents:function(){function b(a,b){return a.dateTime-b.dateTime}a.ajax(this.settings.eclipseEventUrl,{context:this.element,success:function(c){var d=new Date,e=[];for(var f in c.events)c.events[f].dateTime=new Date(c.events[f].date),c.events[f].dateTime>=d&&e.push(c.events[f]);e.sort(b);var g=a("<ul>").attr({class:"nav",style:"margin:0"});for(var h in e.slice(0,5)){var i=e[h].dateTime,j=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2),k=a("<a>").attr({href:e[h].infoLink}).html(e[h].title+"<br/><small>"+j+"</small>"),l=a("<li>").append(k);g.append(l)}a(this).children(".loading").remove(),a(this).append(g);var m=a("<a>").attr({href:"http://events.eclipse.org",class:"btn btn-simple btn-sm"}).text("more");a(this).append(m)},error:function(){a(this).html('<strong><i class="fa red fa-exclamation-triangle" aria-hidden="true"></i>\tAn unexpected error has occurred.</strong>')}})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);